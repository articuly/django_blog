{% extends 'base.html' %}
{% load staticfiles %}

{% block header %}
    {% include 'backend_header.html' %}
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row text-center">
            <div class="col-lg-8 col-md-10 mx-auto">
                <form class="form-horizontal" action="." method="post">
                    <div class="row">
                        <div class="col-sm-2 text-right">标题：</div>
                        <div class="col-sm-10 text-left">{{ blog_form.title }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2 text-right">内容：</div>
                        <div class="col-sm-10 text-left">{{ blog_form.body }}</div>
                    </div>
                    <input type="button" class="btn btn-primary" value="发布文章" onclick="post_blog()">
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/layer.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/csrf.js' %}"></script>
    <script>
        function post_blog() {
            var title = $('#id_title').val()
            var body = $('#id_body').val()
            $.ajax({
                url: "{% url 'blog:blog_post' %}",
                type: "POST",
                data: {'title': title, 'body': body},
                success: function (e) {
                    if (e == '1') {
                        layer.msg("文章发布成功！")
                        location.href("{% url 'blog:blog_home' %}")
                    } else if (e == '-1') {
                        layer.msg("服务器繁忙。")
                    } else {
                        layer.msg("请检查输入的内容，不能为空。")
                    }
                }
            })
        }
    </script>
{% endblock %}